{
	"dashboard": {
		"id": null,
		"uid": null,
		"title": "ETL Monitoring: Prometheus & Loki",
		"tags": ["etl", "prometheus", "loki", "alertmanager"],
		"timezone": "browser",
		"schemaVersion": 38,
		"version": 1,
		"refresh": "30s",
		"panels": [
			{
				"type": "graph",
				"title": "CPU Usage (Node Exporter)",
				"datasource": "Prometheus",
				"targets": [
					{
						"expr": "100 - (avg by (instance) (rate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
						"legendFormat": "{{instance}}",
						"interval": "",
						"refId": "A"
					}
				],
				"alert": {
					"name": "High CPU Usage",
					"conditions": [
						{
							"evaluator": {
								"params": [80],
								"type": "gt"
							},
							"operator": {
								"type": "and"
							},
							"query": {
								"params": ["A"]
							},
							"reducer": {
								"type": "avg"
							},
							"type": "query"
						}
					],
					"frequency": "1m",
					"handler": 1,
					"noDataState": "no_data",
					"executionErrorState": "alerting",
					"notifications": [
						{
							"uid": "alertmanager"
						}
					]
				},
				"fieldConfig": {
					"defaults": {},
					"overrides": []
				},
				"gridPos": {
					"h": 8,
					"w": 12,
					"x": 0,
					"y": 0
				}
			},
			{
				"type": "logs",
				"title": "Keycloak Error Logs (Loki)",
				"datasource": "Loki",
				"targets": [
					{
						"expr": "{job=\"keycloak\"} |= \"ERROR\"",
						"refId": "B"
					}
				],
				"gridPos": {
					"h": 8,
					"w": 12,
					"x": 12,
					"y": 0
				},
				"options": {
					"showTime": true,
					"wrapLogMessage": true,
					"dedupStrategy": "none"
				}
			}
		],
		"annotations": {
			"list": [
				{
					"type": "dashboard",
					"name": "Annotations & Alerts",
					"enable": true
				}
			]
		},
		"templating": {
			"list": []
		}
	},
	"overwrite": true
}
